<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Evidence • automation • 025__F5A3E559D0__ad_create_test-users_30.ps1</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    header { padding: 18px 22px; border-bottom: 1px solid #e5e5e5; }
    h1 { margin: 0 0 6px 0; font-size: 18px; }
    .meta { color: #555; font-size: 13px; }
    .actions { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    a.btn { display: inline-block; padding: 8px 10px; border: 1px solid #ccc; border-radius: 8px; text-decoration: none; color: #111; font-size: 13px; }
    a.btn:hover { background: #f6f6f6; }
    main { padding: 16px 22px; }
    pre { background: #0b0f19; color: #e6e6e6; padding: 14px; border-radius: 12px; overflow: auto; line-height: 1.35; font-size: 13px; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .copy { cursor: pointer; }
    footer { padding: 14px 22px; border-top: 1px solid #e5e5e5; color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div><a href="../../index.html" style="text-decoration:none;">← Evidence home</a></div>
    <h1>025__F5A3E559D0__ad_create_test-users_30.ps1</h1>
    <div class="meta">Category: <b>automation</b> • Last updated: <b>2025-12-23 17:48</b></div>
    <div class="actions">
      <a class="btn" href="../../scripts/automation/025__F5A3E559D0__ad_create_test-users_30.ps1" target="_blank" rel="noopener">Open raw file</a>
      <a class="btn copy" href="#" onclick="copyCode(); return false;">Copy contents</a>
    </div>
  </header>

  <main>
    <pre><code id="code"># Sanitized artifact (025)
# Notes: identifiers/secrets replaced with &lt;REDACTED_*&gt; placeholders.
# Source: &lt;REDACTED_PATH&gt;
&lt;#
What it does
- Creates a batch of test users in a target OU and assigns varied Description values.

When used
- Testing Description-normalization rules, OU scoping, and downstream tooling without touching real users.

Inputs
- TargetOuDn: OU where test accounts will be created.
- DomainControllerFqdn: DC hostname/FQDN (optional).
- Count: number of accounts to create (default: 30).
- InitialPassword: SecureString.
- UserPrincipalNameSuffix / MailDomain: where UPN/mail are formed.

Safety notes
- Destructive: creates accounts. Defaults to dry-run unless `-Apply` (or `-WhatIf`).
- Supports `-WhatIf` / `-Confirm`.

Validation
- Verify the expected number of users exist in the test OU.
- Verify Description distribution matches the intended edge cases.
- Clean up test accounts after validation (disable/delete per policy).

What was sanitized
- Internal domains, OU paths, and hard-coded password removed.
- Original local filename: `Test 30 users 01.ps1`.
#&gt;

[CmdletBinding(SupportsShouldProcess = $true, ConfirmImpact = &#x27;High&#x27;)]
param(
  [string]$DomainControllerFqdn,
  [Parameter(Mandatory = $true)]
  [string]$TargetOuDn = &#x27;OU=&lt;TEST_ACCOUNTS&gt;,OU=Users,DC=example,DC=org&#x27;,
  [int]$Count = 30,
  [string]$NamePrefix = &#x27;Test&#x27;,
  [string]$LastName = &#x27;ScriptTestUser&#x27;,
  [string]$UserPrincipalNameSuffix = &#x27;example.org&#x27;,
  [string]$MailDomain = &#x27;example.org&#x27;,
  [SecureString]$InitialPassword,
  [switch]$Apply
)

Set-StrictMode -Version Latest
$ErrorActionPreference = &#x27;Stop&#x27;
$ProgressPreference = &#x27;SilentlyContinue&#x27;

Import-Module ActiveDirectory -ErrorAction Stop

if ($DomainControllerFqdn) {
  $PSDefaultParameterValues[&#x27;*-AD*:Server&#x27;] = $DomainControllerFqdn
}

if (-not $InitialPassword) {
  $InitialPassword = Read-Host -Prompt &#x27;Initial password (SecureString)&#x27; -AsSecureString
}

if (-not $Apply -and -not $WhatIfPreference) {
  Write-Warning &quot;Dry run: no accounts will be created. Re-run with -Apply (or use -WhatIf to preview actions).&quot;
}

$randomWords = @(&#x27;accountant&#x27;,&#x27;corporate&#x27;,&#x27;finance&#x27;,&#x27;maintenance&#x27;,&#x27;support&#x27;,&#x27;analyst&#x27;,&#x27;manager&#x27;,&#x27;engineer&#x27;,&#x27;operator&#x27;,&#x27;contractor&#x27;,&#x27;vendor&#x27;,&#x27;tester&#x27;)
$rng = [System.Random]::new()

function New-RandomTail([int]$MinWords = 1, [int]$MaxWords = 3) {
  $count = $rng.Next($MinWords, $MaxWords + 1)
  $words = for ($i = 0; $i -lt $count; $i++) { $randomWords[$rng.Next(0, $randomWords.Count)] }
  return ($words -join &#x27; &#x27;)
}

for ($i = 0; $i -lt $Count; $i++) {
  $firstName = &#x27;{0}{1:00}&#x27; -f $NamePrefix, $i
  $sam = (($firstName.Substring(0,1) + &#x27;.&#x27; + $LastName.Substring(0, [Math]::Min(5, $LastName.Length))) -replace &#x27;[^A-Za-z0-9\\.]&#x27;,&#x27;&#x27;).ToLowerInvariant()
  $upn = &quot;$sam@$UserPrincipalNameSuffix&quot;
  $mail = &quot;$sam@$MailDomain&quot;

  $desc = &#x27;&#x27;
  if ($i -lt 5)      { $desc = &quot;Consultant $(New-RandomTail 1 2)&quot; }
  elseif ($i -lt 10) { $desc = &quot;Temp $(New-RandomTail 1 2)&quot; }
  elseif ($i -lt 25) { $desc = &quot; $(New-RandomTail 1 3)&quot;.Trim() }
  elseif ($i -eq 27) { $desc = &#x27;Test&#x27; }
  elseif ($i -eq 28) { $desc = &#x27;Vendor&#x27; }
  elseif ($i -eq 29) { $desc = &#x27;Testing&#x27; }

  $plan = [pscustomobject]@{
    Name = &quot;$firstName $LastName&quot;
    SamAccountName = $sam
    UserPrincipalName = $upn
    Mail = $mail
    Description = $desc
  }

  if (-not $Apply -and -not $WhatIfPreference) {
    $plan
    continue
  }

  if ($PSCmdlet.ShouldProcess($plan.SamAccountName, &quot;Create test user in $TargetOuDn&quot;)) {
    New-ADUser -Name $plan.Name `
      -GivenName $firstName `
      -Surname $LastName `
      -SamAccountName $plan.SamAccountName `
      -UserPrincipalName $plan.UserPrincipalName `
      -EmailAddress $plan.Mail `
      -Path $TargetOuDn `
      -Enabled $true `
      -PasswordNeverExpires $true `
      -ChangePasswordAtLogon $false `
      -AccountPassword $InitialPassword `
      -Description $plan.Description | Out-Null
  }
}

Write-Host &quot;Done. (Dry-run=$(-not $Apply -and -not $WhatIfPreference))&quot;


</code></pre>
  </main>

  <footer>
    Sanitized evidence. No tenant IDs, internal domains, user identifiers, private URLs, or secrets.
  </footer>

  <script>
    function copyCode() {
      const el = document.getElementById('code');
      const txt = el.innerText;
      navigator.clipboard.writeText(txt).then(() => alert('Copied to clipboard'))
        .catch(() => alert('Copy failed (clipboard blocked). You can still select text in the box.'));
    }
  </script>
</body>
</html>
